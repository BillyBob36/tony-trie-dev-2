<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Sheets AI Matcher</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="config-deployed.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Google Sheets AI Matcher</h1>
            <p>Trouvez des profils correspondant √† vos crit√®res avec l'intelligence artificielle</p>
        </header>

        <!-- Section d'authentification -->
        <div id="auth-section" class="section">
            <h2>üîê Connexion Google</h2>
            <div id="signin-button"></div>
            <div id="user-info" style="display: none;">
                <p>Connect√© en tant que: <span id="user-name"></span></p>
                <button id="signout-button" class="btn btn-secondary">Se d√©connecter</button>
            </div>
        </div>

        <!-- Section principale (cach√©e jusqu'√† l'authentification) -->
        <div id="main-content" style="display: none;">
            
            <!-- Configuration des crit√®res -->
            <div class="section">
                <h2>üìã Configuration des Crit√®res</h2>
                
                <div class="criteria-container">
                    <h3>Crit√®res de Filtrage</h3>
                    <div id="criteria-list"></div>
                    <button id="add-criteria" class="btn btn-primary">+ Ajouter un Crit√®re</button>
                </div>

                <div class="matching-container">
                    <h3>Donn√©es √† Analyser</h3>
                    <div id="target-data-config">
                        <div class="data-selector">
                            <label>Fichier source des profils:</label>
                            <select id="target-spreadsheet" class="form-control">
                                <option value="">S√©lectionner un fichier...</option>
                            </select>
                        </div>
                        <div class="data-selector">
                            <label>Feuille:</label>
                            <select id="target-sheet" class="form-control">
                                <option value="">S√©lectionner une feuille...</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="output-container">
                    <h3>Destination des R√©sultats</h3>
                    <div id="output-config">
                        <div class="data-selector">
                            <label>Fichier de sortie:</label>
                            <select id="output-spreadsheet" class="form-control">
                                <option value="">S√©lectionner un fichier...</option>
                            </select>
                        </div>
                        <div class="data-selector">
                            <label>Feuille de sortie:</label>
                            <select id="output-sheet" class="form-control">
                                <option value="">S√©lectionner une feuille...</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration de l'IA -->
            <div class="section">
                <h2>ü§ñ Configuration de l'IA</h2>
                <div class="ai-config">
                    <h3>Configuration IA</h3>
                    
                    <div class="ai-tabs">
                        <button class="tab-btn active" data-tab="prompt">Prompt IA</button>
                        <button class="tab-btn" data-tab="parameters">Param√®tres</button>
                        <button class="tab-btn" data-tab="tolerance">Tol√©rance</button>
                    </div>
                    
                    <div class="tab-content">
                        <!-- Onglet Prompt IA -->
                        <div id="prompt-tab" class="tab-panel active">
                            <div class="form-group">
                                <label for="ai-prompt">Prompt IA (Instructions pour l'analyse):</label>
                                <div class="prompt-controls">
                                    <button id="reset-prompt" class="btn btn-secondary btn-sm">R√©initialiser</button>
                                    <button id="save-prompt" class="btn btn-primary btn-sm">Sauvegarder</button>
                                </div>
                                <textarea id="ai-prompt" rows="8" placeholder="Instructions pour l'IA..."></textarea>
                                <div class="prompt-help">
                                    <p><strong>Conseils pour un bon prompt :</strong></p>
                                    <ul>
                                        <li>Soyez pr√©cis sur les crit√®res de correspondance</li>
                                        <li>D√©finissez clairement ce qui constitue une correspondance valide</li>
                                        <li>Incluez des exemples de correspondances acceptables</li>
                                        <li>Sp√©cifiez le format de r√©ponse attendu (OUI/NON)</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Onglet Param√®tres -->
                        <div id="parameters-tab" class="tab-panel">
                            <div class="form-group">
                                <label for="ai-model">Mod√®le IA:</label>
                                <select id="ai-model">
                                    <option value="gpt-5-nano" selected>GPT-5 Nano (Le plus rapide et √©conomique)</option>
                                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Rapide)</option>
                                    <option value="gpt-4">GPT-4 (Plus pr√©cis)</option>
                                    <option value="gpt-4-turbo">GPT-4 Turbo (√âquilibr√©)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="ai-temperature">Cr√©ativit√© (Temperature): <span id="temperature-value">0</span></label>
                                <input type="range" id="ai-temperature" min="0" max="1" step="0.1" value="0">
                                <small>0 = Tr√®s pr√©cis, 1 = Plus cr√©atif</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="ai-max-tokens">Tokens maximum:</label>
                                <input type="number" id="ai-max-tokens" value="10" min="5" max="100">
                                <small>Nombre maximum de tokens pour la r√©ponse</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="ai-timeout">Timeout (secondes):</label>
                                <input type="number" id="ai-timeout" value="30" min="10" max="120">
                                <small>D√©lai d'attente maximum pour chaque requ√™te</small>
                            </div>
                        </div>
                        
                        <!-- Onglet Tol√©rance -->
                        <div id="tolerance-tab" class="tab-panel">
                            <div class="form-group">
                                <label for="match-threshold">Seuil de correspondance: <span id="threshold-value">95</span>%</label>
                                <input type="range" id="match-threshold" min="0" max="100" step="5" value="95">
                                <small>Score minimum pour consid√©rer une correspondance comme valide</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="retry-attempts">Tentatives en cas d'erreur:</label>
                                <input type="number" id="retry-attempts" value="3" min="1" max="10">
                                <small>Nombre de tentatives avant d'abandonner une requ√™te</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="batch-delay">D√©lai entre les lots (ms):</label>
                                <input type="number" id="batch-delay" value="1000" min="100" max="5000" step="100">
                                <small>Pause entre les lots pour √©viter les limites de taux</small>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="fallback-matching" checked>
                                    Utiliser la correspondance de secours en cas d'√©chec IA
                                </label>
                                <small>Active une correspondance basique si l'IA √©choue</small>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="case-sensitive" checked>
                                    Correspondance sensible √† la casse
                                </label>
                                <small>Prendre en compte les majuscules/minuscules</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section de traitement -->
            <div class="section">
                <h2>‚ö° Traitement</h2>
                
                <div class="form-group">
                    <label for="rows-limit">Nombre de lignes √† analyser:</label>
                    <select id="rows-limit" class="form-control">
                        <option value="100">100 lignes</option>
                        <option value="200">200 lignes</option>
                        <option value="500">500 lignes</option>
                        <option value="all" selected>Toutes les lignes</option>
                    </select>
                    <small>Limitez le nombre de lignes pour des tests rapides</small>
                </div>
                
                <div class="processing-controls">
                    <button id="start-processing" class="btn btn-success btn-large">üöÄ D√©marrer l'Analyse</button>
                    <button id="stop-processing" class="btn btn-danger" style="display: none;">‚èπÔ∏è Arr√™ter</button>
                </div>
                
                <div id="progress-section" style="display: none;">
                    <div class="progress-bar">
                        <div id="progress-fill"></div>
                    </div>
                    <div id="progress-text">Pr√©paration...</div>
                    <div id="processing-stats">
                        <span id="processed-count">0</span> profils trait√©s | 
                        <span id="matched-count">0</span> correspondances trouv√©es
                    </div>
                </div>

                <div id="results-section" style="display: none;">
                    <h3>üìä R√©sultats</h3>
                    <div id="results-summary"></div>
                    <div id="results-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour ajouter un crit√®re -->
    <div id="criteria-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Ajouter un Crit√®re</h3>
            <form id="criteria-form">
                <div class="form-group">
                    <label>Nom du crit√®re:</label>
                    <input type="text" id="criteria-name" class="form-control" placeholder="Ex: Entreprises int√©ressantes">
                </div>
                <div class="form-group">
                    <label>Fichier Google Sheets:</label>
                    <select id="criteria-spreadsheet" class="form-control">
                        <option value="">S√©lectionner un fichier...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Feuille:</label>
                    <select id="criteria-sheet" class="form-control">
                        <option value="">S√©lectionner une feuille...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Colonne:</label>
                    <select id="criteria-column" class="form-control">
                        <option value="">S√©lectionner une colonne...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Colonne correspondante dans les donn√©es cibles:</label>
                    <select id="target-column" class="form-control">
                        <option value="">S√©lectionner une colonne...</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Ajouter</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCriteriaModal()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>